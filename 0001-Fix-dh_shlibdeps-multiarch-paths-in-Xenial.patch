From a05a3f865a99b94c67cda3dc50afe4d2eaf2975b Mon Sep 17 00:00:00 2001
From: Jose Luis Blanco-Claraco <joseluisblancoc@gmail.com>
Date: Thu, 7 Jun 2018 08:50:19 +0200
Subject: [PATCH] Fix dh_shlibdeps multiarch paths in Xenial

---
 debian/rules.em | 51 +++++++++++++++++++++++++++++++++++++++++++++++--
 1 file changed, 49 insertions(+), 2 deletions(-)

diff --git a/debian/rules.em b/debian/rules.em
index aa010fa..13956c9 100755
--- a/debian/rules.em
+++ b/debian/rules.em
@@ -18,6 +18,9 @@ export PKG_CONFIG_PATH=@(InstallationPrefix)/lib/pkgconfig
 # 	https://github.com/ros-infrastructure/bloom/issues/327
 export DEB_CXXFLAGS_MAINT_APPEND=-DNDEBUG
 
+# JLBC: Added for mrpt install prefixes, to solve shlibdeps errors in Xenial:
+export DEB_HOST_MULTIARCH := $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
+
 %:
 	dh $@@ -v --buildsystem=cmake
 
@@ -26,7 +29,51 @@ override_dh_auto_configure:
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
 	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
-	dh_auto_configure -- -DCMAKE_INSTALL_PREFIX="@(InstallationPrefix)"
+	dh_auto_configure -- -DCMAKE_INSTALL_PREFIX="@(InstallationPrefix)" \
+	-DBUILD_APP_2d-slam-demo=OFF \
+	-DBUILD_APP_DifOdometry-Camera=OFF \
+	-DBUILD_APP_DifOdometry-Datasets=OFF \
+	-DBUILD_APP_GridmapNavSimul=OFF \
+	-DBUILD_APP_RawLogViewer=ON \
+	-DBUILD_APP_ReactiveNav3D-Demo=OFF \
+	-DBUILD_APP_ReactiveNavigationDemo=OFF \
+	-DBUILD_APP_SceneViewer3D=ON \
+	-DBUILD_APP_camera-calib=ON \
+	-DBUILD_APP_carmen2rawlog=OFF \
+	-DBUILD_APP_carmen2simplemap=OFF \
+	-DBUILD_APP_features-matching=OFF \
+	-DBUILD_APP_gps2rawlog=ON \
+	-DBUILD_APP_graph-slam=ON \
+	-DBUILD_APP_graphslam-engine=OFF \
+	-DBUILD_APP_grid-matching=OFF \
+	-DBUILD_APP_hmt-slam=OFF \
+	-DBUILD_APP_hmt-slam-gui=OFF \
+	-DBUILD_APP_hmtMapViewer=OFF \
+	-DBUILD_APP_holonomic-navigator-demo=OFF \
+	-DBUILD_APP_icp-slam=ON \
+	-DBUILD_APP_icp-slam-live=ON \
+	-DBUILD_APP_image2gridmap=ON \
+	-DBUILD_APP_kf-slam=OFF \
+	-DBUILD_APP_kinect-3d-slam=OFF \
+	-DBUILD_APP_kinect-3d-view=OFF \
+	-DBUILD_APP_kinect-stereo-calib=OFF \
+	-DBUILD_APP_map-partition=OFF \
+	-DBUILD_APP_mrpt-perfdata2html=OFF \
+	-DBUILD_APP_mrpt-performance=OFF \
+	-DBUILD_APP_navlog-viewer=ON \
+	-DBUILD_APP_observations2map=ON \
+	-DBUILD_APP_pf-localization=OFF \
+	-DBUILD_APP_ptg-configurator=ON \
+	-DBUILD_APP_rawlog-edit=ON \
+	-DBUILD_APP_rawlog-grabber=ON \
+	-DBUILD_APP_rbpf-slam=ON \
+	-DBUILD_APP_ro-localization=OFF \
+	-DBUILD_APP_robotic-arm-kinematics=OFF \
+	-DBUILD_APP_simul-beacons=OFF \
+	-DBUILD_APP_simul-gridmap=OFF \
+	-DBUILD_APP_simul-landmarks=OFF \
+	-DBUILD_APP_track-video-features=OFF \
+	-DBUILD_APP_velodyne-view=ON
 
 override_dh_auto_build:
 	# In case we're installing to a non-standard location, look for a setup.sh
@@ -48,7 +95,7 @@ override_dh_shlibdeps:
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
 	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
-	dh_shlibdeps -l$(CURDIR)/debian/@(Package)/@(InstallationPrefix)/lib/
+	dh_shlibdeps -l$(CURDIR)/debian/@(Package)/@(InstallationPrefix)/lib/ -l$(CURDIR)/debian/@(Package)/@(InstallationPrefix)/lib/${DEB_HOST_MULTIARCH}
 
 override_dh_auto_install:
 	# In case we're installing to a non-standard location, look for a setup.sh
-- 
2.17.1

